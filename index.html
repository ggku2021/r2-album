<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æˆ‘çš„ GitHub å›¾åºŠç›¸å†Œ</title>
    <style>
        /* åŸºç¡€æ ·å¼ */
        body { font-family: sans-serif; margin: 20px; background-color: #f4f4f9; }
        h1 { color: #333; text-align: center; margin-bottom: 40px; }
        #gallery {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            justify-content: center;
        }

        /* ç›¸å†Œ/å›¾ç‰‡é¡¹æ ·å¼ */
        .item-card {
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            width: 250px; /* ç»Ÿä¸€å¡ç‰‡å®½åº¦ */
            text-align: center;
            transition: transform 0.2s;
            cursor: pointer;
            height: auto; /* å…³é”®ï¼šé«˜åº¦ç”±å†…å®¹å†³å®šï¼Œæ¶ˆé™¤å¤šä½™ç©ºç™½ */
        }
        .item-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
        }

        /* æ–‡ä»¶å¤¹ï¼ˆç›¸å†Œï¼‰æ ·å¼ï¼šä¿æŒç»Ÿä¸€æ€§ */
        .folder-card {
            background-color: #e0f7fa;
            padding: 20px;
            font-size: 1.2em;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
            height: 250px; /* è®©æ–‡ä»¶å¤¹å¡ç‰‡é«˜åº¦å’Œå›¾ç‰‡æ˜¾ç¤ºåŒºåŸŸä¸€è‡´ */
        }
        .folder-card::before {
            content: "ğŸ“";
            margin-right: 10px;
            font-size: 1.5em;
        }

        /* ğŸ† å›¾ç‰‡å®¹å™¨å’Œå›¾ç‰‡æœ¬èº«çš„æ ·å¼ ğŸ† */
        .image-container {
            /* æ–°å¢å®¹å™¨ï¼šå¼ºåˆ¶ç»Ÿä¸€å›¾ç‰‡æ˜¾ç¤ºåŒºåŸŸé«˜åº¦ */
            width: 100%;
            height: 250px; 
            overflow: hidden; /* è£å‰ªæº¢å‡ºéƒ¨åˆ† */
        }

        .image-card img {
            width: 100%;
            height: 100%; /* å¡«æ»¡çˆ¶å®¹å™¨ (250px) */
            display: block;
            
            /* æ ¸å¿ƒå±æ€§ï¼šå†…å®¹å¡«æ»¡å®¹å™¨ï¼Œä¿æŒæ¯”ä¾‹å¹¶è£å‰ª */
            object-fit: cover; 
            
            transition: transform 0.3s ease-in-out;
        }
        .image-card:hover img {
            transform: scale(1.05);
        }

        .image-card p {
            padding: 10px;
            margin: 0;
            color: #555;
            font-size: 0.9em;
            /* æ–‡å­—åŒºåŸŸç¡®ä¿ç´§å‡‘å’Œå±…ä¸­ */
            min-height: 40px; 
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        /* æç¤ºä¿¡æ¯ */
        #message {
            text-align: center;
            color: #888;
            margin-top: 50px;
        }
    </style>
</head>
<body>

    <h1 id="page-title">ç›¸å†Œä¸»é¡µ</h1>
    <div id="gallery">
        <div id="message">æ­£åœ¨åŠ è½½ç›¸å†Œå†…å®¹...</div>
    </div>
    
    <script>
        // =======================================================
        // ğŸš€ é…ç½®ä¿¡æ¯ï¼ˆå·²æ ¹æ®æ‚¨çš„ä»“åº“ ggku2021/r2-album è®¾ç½®ï¼‰
        // =======================================================
        const GITHUB_USERNAME = 'ggku2021'; 
        const GITHUB_REPO_NAME = 'r2-album'; 
        const GITHUB_BRANCH = 'main'; 
        const BASE_PATH = 'img'; 
        // =======================================================

        const gallery = document.getElementById('gallery');
        const message = document.getElementById('message');
        const pageTitle = document.getElementById('page-title');

        /**
         * è·å– GitHub ä»“åº“å†…å®¹çš„ API URL
         */
        function getContentApiUrl(path) {
            return `https://api.github.com/repos/${GITHUB_USERNAME}/${GITHUB_REPO_NAME}/contents/${path}?ref=${GITHUB_BRANCH}`;
        }

        /**
         * ç”Ÿæˆå›¾ç‰‡ CDN é“¾æ¥ï¼ˆä½¿ç”¨ jsDelivr åŠ é€Ÿï¼‰
         */
        function getCdnUrl(path) {
            const cleanPath = path.startsWith('/') ? path.substring(1) : path; 
            return `https://cdn.jsdelivr.net/gh/${GITHUB_USERNAME}/${GITHUB_REPO_NAME}@${GITHUB_BRANCH}/${cleanPath}`;
        }

        /**
         * åˆ¤æ–­æ˜¯å¦ä¸ºå›¾ç‰‡æ–‡ä»¶
         */
        function isImage(name) {
            const lowerName = name.toLowerCase();
            return lowerName.endsWith('.jpg') || 
                   lowerName.endsWith('.jpeg') || 
                   lowerName.endsWith('.png') || 
                   lowerName.endsWith('.gif') || 
                   lowerName.endsWith('.webp');
        }

        /**
         * æ¸²æŸ“ç›¸å†Œå†…å®¹
         */
        async function renderGallery(currentPath) {
            const isRoot = currentPath === BASE_PATH;
            const folderName = currentPath.split('/').pop();
            pageTitle.textContent = isRoot ? 'ç›¸å†Œä¸»é¡µ' : `ç›¸å†Œï¼š${folderName}`;
            gallery.innerHTML = '';
            message.textContent = 'æ­£åœ¨åŠ è½½...';
            
            try {
                const response = await fetch(getContentApiUrl(currentPath));
                if (!response.ok) {
                    throw new Error(`GitHub API é”™è¯¯: ${response.status} ${response.statusText}`);
                }
                const data = await response.json();
                
                if (data.length === 0) {
                    message.textContent = 'æ­¤ç›¸å†Œä¸ºç©ºã€‚';
                    return;
                }

                message.style.display = 'none';

                // 1. æ¸²æŸ“è¿”å›æŒ‰é’®
                if (currentPath !== BASE_PATH) {
                    const parentPath = currentPath.substring(0, currentPath.lastIndexOf('/'));
                    const backButton = createFolderCard('... è¿”å›ä¸Šä¸€çº§', parentPath);
                    backButton.style.backgroundColor = '#ffcdd2'; 
                    gallery.appendChild(backButton);
                }

                // 2. æ¸²æŸ“æ–‡ä»¶å¤¹
                data.filter(item => item.type === 'dir').forEach(folder => {
                    gallery.appendChild(createFolderCard(folder.name, folder.path));
                });

                // 3. æ¸²æŸ“å›¾ç‰‡æ–‡ä»¶
                data.filter(item => item.type === 'file' && isImage(item.name)).forEach(file => {
                    gallery.appendChild(createImageCard(file.name, file.path));
                });

            } catch (error) {
                console.error("åŠ è½½ç›¸å†Œå¤±è´¥:", error);
                message.textContent = `åŠ è½½å¤±è´¥ï¼Œè¯·æ£€æŸ¥é…ç½®å’Œç½‘ç»œã€‚é”™è¯¯ï¼š${error.message}`;
            }
        }

        /**
         * åˆ›å»ºæ–‡ä»¶å¤¹å¡ç‰‡å…ƒç´ 
         */
        function createFolderCard(name, path) {
            const card = document.createElement('div');
            card.className = 'item-card folder-card';
            card.textContent = name;
            card.onclick = () => renderGallery(path); 
            return card;
        }

        /**
         * ğŸ† åˆ›å»ºå›¾ç‰‡å¡ç‰‡å…ƒç´  (å·²ä¿®æ”¹ç»“æ„) ğŸ†
         */
        function createImageCard(name,